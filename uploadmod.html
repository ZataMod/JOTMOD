<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload And Remove Mod</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        input, button, select {
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            max-width: 400px;
            border-radius: 5px;
            border: none;
        }
        input, select {
            background-color: #2e2e2e;
            color: #fff;
        }
        button {
            background-color: #6200ea;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background-color: #3700b3;
        }
        #toggleSwitch {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .switch {
            position: relative;
            width: 60px;
            height: 34px;
            display: inline-block;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            border-radius: 50%;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
        }
        input:checked + .slider {
            background-color: #6200ea;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <h2>Upload And Remove Mod</h2>
    <h3 id="formTitle">Upload Mod</h3>

    <div id="toggleSwitch">
        <label class="switch">
            <input type="checkbox" id="toggleFormSwitch" onclick="toggleForm()">
            <span class="slider"></span>
        </label>
    </div>

    <div id="formContent">
        <input type="text" id="image" placeholder="Image URL" required><br>
        <input type="text" id="name" placeholder="Name Mod" required><br>
        <input type="text" id="url" placeholder="URL Mod" required><br>
        <button onclick="updateXML()">Thêm</button>
    </div>

    <div id="removeContent" style="display: none;">
        <select id="nameSelect">
            <option value="">Chọn mục cần gỡ...</option>
        </select><br>
        <button onclick="removeXML()">Gỡ</button>
    </div>

    <script>
        const apiKey = "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"; 
        const repoOwner = "ZataMod";
        const repoName = "Skin.xml";
        const filePath = "A.xml";
        const githubApiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

        function utf8ToBase64(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        function base64ToUtf8(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        async function updateXML() {
            const image = document.getElementById('image').value;
            const name = document.getElementById('name').value;
            const url = document.getElementById('url').value;

            if (!image || !name || !url) {
                alert("Vui lòng nhập đầy đủ thông tin.");
                return;
            }

            const newEntry = `  <String image="${image}" name="${name}" url="${url}" />\n`;

            try {
                const response = await fetch(githubApiUrl, {
                    headers: { 'Authorization': `token ${apiKey}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                const fileData = await response.json();
                const sha = fileData.sha;
                const content = base64ToUtf8(fileData.content);

                const updatedContent = content.replace('</products>', `${newEntry}</products>`);
                const encodedContent = utf8ToBase64(updatedContent);

                await fetch(githubApiUrl, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `token ${apiKey}`, 
                        'Accept': 'application/vnd.github.v3+json', 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: "Add new String to A.xml",
                        content: encodedContent,
                        sha: sha
                    })
                });

                alert('Thêm thành công!');
                location.reload();
            } catch (error) {
                alert('Lỗi: ' + error.message);
            }
        }

        async function loadNames() {
            try {
                const response = await fetch(githubApiUrl, {
                    headers: { 'Authorization': `token ${apiKey}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                const fileData = await response.json();
                const content = base64ToUtf8(fileData.content);

                const matches = content.match(/<String image=".*?" name="(.*?)" url=".*?" \/>/g);
                const nameSelect = document.getElementById('nameSelect');
                nameSelect.innerHTML = '<option value="">Chọn mục cần gỡ...</option>';

                if (matches) {
                    matches.forEach(str => {
                        const nameMatch = str.match(/name="(.*?)"/);
                        if (nameMatch) {
                            const name = nameMatch[1];
                            const option = document.createElement('option');
                            option.value = name;
                            option.textContent = name;
                            nameSelect.appendChild(option);
                        }
                    });
                }
            } catch (error) {
                alert('Lỗi: ' + error.message);
            }
        }

        async function removeXML() {
            const nameToRemove = document.getElementById('nameSelect').value;

            if (!nameToRemove) {
                alert("Vui lòng chọn mục cần gỡ.");
                return;
            }

            try {
                const response = await fetch(githubApiUrl, {
                    headers: { 'Authorization': `token ${apiKey}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                const fileData = await response.json();
                const sha = fileData.sha;
                let content = base64ToUtf8(fileData.content);

                const updatedContent = content.replace(new RegExp(`  <String image=".*?" name="${nameToRemove}" url=".*?" />\n?`, 'g'), '');
                const encodedContent = utf8ToBase64(updatedContent);

                await fetch(githubApiUrl, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `token ${apiKey}`, 
                        'Accept': 'application/vnd.github.v3+json', 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: "Remove String from A.xml",
                        content: encodedContent,
                        sha: sha
                    })
                });

                alert('Gỡ bỏ thành công!');
                location.reload();
            } catch (error) {
                alert('Lỗi: ' + error.message);
            }
        }

        function toggleForm() {
            const formTitle = document.getElementById('formTitle');
            const formContent = document.getElementById('formContent');
            const removeContent = document.getElementById('removeContent');
            const toggleSwitch = document.getElementById('toggleFormSwitch');

            if (toggleSwitch.checked) {
                formTitle.textContent = "Remove Mod";
                formContent.style.display = 'none';
                removeContent.style.display = 'block';
                loadNames();
            } else {
                formTitle.textContent = "Thêm String";
                formContent.style.display = 'block';
                removeContent.style.display = 'none';
            }
        }
    </script>
</body>
</html>
